# =====================================
# Morphologic Spectrum Assignment Config
# =====================================
N_CLASSES: 4

LABEL_MAP:
  0: "Clear_Cell_Carcinoma"
  1: "Ovarian_Endometrioid_Carcinoma"
  2: "Ovarian_High_Grade_Serous_Carcinoma"
  3: "Ovarian_Serous_Borderline"

LABEL_MAP_SHORT:
  0: "Clear"
  1: "Endo"
  2: "High"
  3: "Border"

LABEL_NAME_TO_INDEX:
  Clear_Cell_Carcinoma: 0
  Ovarian_Endometrioid_Carcinoma: 1
  Ovarian_High_Grade_Serous_Carcinoma: 2
  Ovarian_Serous_Borderline: 3

subtypes:
  # Mapping between long subtype names and short codes
  long_to_short:
    Clear_Cell_Carcinoma: "Clear"
    Ovarian_Endometrioid_Carcinoma: "Endo"
    Ovarian_High_Grade_Serous_Carcinoma: "High"
    Ovarian_Serous_Borderline: "Border"

  # Groups that enable the EC–HGSC mixed (transition) mode
  mixture_enabled_groups: ["Endo", "High", "Endo_High", "High_Endo"]


algorithm:
  # --- Mahalanobis statistics ---
  shrink_lambda: 0.20

  # --- RBF weighting ---
  tau_mode: "iqr"       # "iqr" | "constant"
  tau_floor: 0.25
  tau_constant: 1.0

  # --- Transition detection ---
  knn_distance: "cosine" # "cosine" | "l2"
  knn_k: 30
  imbalance_alpha: 0.5

  # --- Transition density thresholds ---
  ptrans_margin: 0.0
  ptrans_abs_min: 0.04
  conf_min: 0.55

  # --- Outlier relaxation ---
  outlier_relax_rel: 0.10
  outlier_relax_abs: 4.0

  # --- Patch filtering ---
  min_patches_per_slide: 10

  attn_model_size: "small"
  input_feature_size: 512
  display_level: 2
  

output:
  # Directory naming and output file names
  patch_csv_pattern: "{slide_id}_patch_assign.csv"
  matrix_name: "slide_cluster_matrix.csv"
  tiles_csv_name: "{slide_id}_spectrum_tiles.csv"      # 中间 tiles CSV 文件名
  geojson_name: "{slide_id}_ATTN+SPECTRUM.geojson" 